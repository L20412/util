<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>PluralKit Export Viewer</title>
<style>
body {
    font-family: -apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;
    background: #121212;
    color: #f5f5f5;
    margin: 0;
    padding: 20px;
}

h1 { color: #ff8c00; }

.card {
    background: #1e1e1e;
    border-left: 4px solid #ff8c00;
    border-radius: 12px;
    padding: 15px;
    margin: 15px 0;
    box-shadow: 0 0 12px rgba(0,0,0,0.5);
}

.member-card {
    display: flex;
    gap: 15px;
}

.member-avatar {
    width: 80px;
    height: 80px;
    border-radius: 50%;
    background: #333;
    object-fit: cover;
}

textarea {
    width: 100%;
    height: 140px;
    background: #1e1e1e;
    color: #fff;
    border: 1px solid #444;
    border-radius: 8px;
    padding: 10px;
    margin-bottom: 10px;
}

button {
    background: #ff8c00;
    border: none;
    padding: 8px 14px;
    border-radius: 8px;
    color: black;
    font-weight: bold;
    cursor: pointer;
    margin-right: 5px;
}

button:hover { background: #ffa733; }

.tabs {
    margin-top: 20px;
    display: flex;
    gap: 10px;
}

.tab-btn {
    background: #1e1e1e;
    color: #ff8c00;
    border: 1px solid #ff8c00;
}

.tab-btn.active {
    background: #ff8c00;
    color: black;
}

.tab-content { display: none; }
.tab-content.active { display: block; }

.tag {
    background: #2c2c2c;
    padding: 4px 8px;
    border-radius: 8px;
    margin: 2px;
    display: inline-block;
    font-size: 12px;
}
</style>
</head>
<body>

<h1>ðŸŸ  PluralKit Export Viewer</h1>

<h2>Load JSON</h2>
<input type="file" id="fileInput" accept=".json"><br>
<textarea id="jsonInput" placeholder="Paste exported JSON here..."></textarea>
<button onclick="loadFromText()">Load From Text</button>
<button onclick="clearViewer()">Clear</button>

<div id="systemInfo"></div>

<div id="tabsSection" style="display:none;">
    <div class="tabs">
        <button class="tab-btn active" onclick="showTab('members')">Members</button>
        <button class="tab-btn" onclick="showTab('groups')">Groups</button>
        <button class="tab-btn" onclick="showTab('switches')">Switch History</button>
    </div>

    <div id="members" class="tab-content active"></div>
    <div id="groups" class="tab-content"></div>
    <div id="switches" class="tab-content"></div>
</div>

<script>

let currentData = null;

function showTab(id) {
    document.querySelectorAll(".tab-content").forEach(t => t.classList.remove("active"));
    document.querySelectorAll(".tab-btn").forEach(b => b.classList.remove("active"));
    document.getElementById(id).classList.add("active");
    event.target.classList.add("active");
}

function renderSystem(data) {
    currentData = data;

    if (!data.members) {
        alert("Invalid PluralKit export.");
        return;
    }

    document.getElementById("tabsSection").style.display = "block";

    // System info
    document.getElementById("systemInfo").innerHTML = `
        <div class="card">
            <h2>${data.name || "Unnamed System"}</h2>
            <p>${data.description || "No description"}</p>
            <p><strong>Created:</strong> ${data.created ? new Date(data.created).toLocaleString() : "Unknown"}</p>
            <p><strong>Timezone:</strong> ${data.config?.timezone || "Unknown"}</p>
        </div>
    `;

    renderMembers();
    renderGroups();
    renderSwitches();
}

function renderMembers() {
    const container = document.getElementById("members");
    container.innerHTML = `<h2>Members (${currentData.members.length})</h2>`;

    currentData.members.forEach(member => {
        const avatar = member.avatar_url || "https://via.placeholder.com/80";
        const color = member.color ? `#${member.color}` : "#ff8c00";

        // Find groups this member belongs to
        const memberGroups = currentData.groups
            .filter(g => g.members.includes(member.id))
            .map(g => g.display_name || g.name);

        container.innerHTML += `
        <div class="card member-card">
            <img class="member-avatar" src="${avatar}">
            <div>
                <h3 style="color:${color}">${member.display_name || member.name}</h3>
                <p><strong>ID:</strong> ${member.id}</p>
                <p><strong>Pronouns:</strong> ${member.pronouns || "Not set"}</p>
                <p><strong>Messages:</strong> ${member.message_count}</p>
                <p><strong>Groups:</strong> ${
                    memberGroups.length
                        ? memberGroups.map(g => `<span class="tag">${g}</span>`).join("")
                        : "None"
                }</p>

                <details>
                    <summary>More Info</summary>
                    <p><strong>Birthday:</strong> ${member.birthday || "Not set"}</p>
                    <p><strong>Description:</strong><br>${member.description || "None"}</p>
                </details>
            </div>
        </div>
        `;
    });
}

function renderGroups() {
    const container = document.getElementById("groups");
    container.innerHTML = `<h2>Groups (${currentData.groups.length})</h2>`;

    currentData.groups.forEach(group => {
        container.innerHTML += `
        <div class="card">
            <h3>${group.display_name || group.name}</h3>
            <p>${group.description || "No description"}</p>
            <p><strong>Members:</strong></p>
            ${
                group.members.map(id => {
                    const m = currentData.members.find(mem => mem.id === id);
                    return `<span class="tag">${m ? (m.display_name || m.name) : id}</span>`;
                }).join("")
            }
        </div>
        `;
    });
}

function renderSwitches() {
    const container = document.getElementById("switches");
    container.innerHTML = `<h2>Switch History</h2>`;

    if (!currentData.switches || currentData.switches.length === 0) {
        container.innerHTML += `<p>No switches recorded.</p>`;
        return;
    }

    currentData.switches.forEach(sw => {
        const names = sw.members.map(id => {
            const m = currentData.members.find(mem => mem.id === id);
            return m ? (m.display_name || m.name) : id;
        }).join(", ");

        container.innerHTML += `
            <div class="card">
                <p><strong>Date:</strong> ${new Date(sw.timestamp).toLocaleString()}</p>
                <p><strong>Front:</strong> ${names}</p>
            </div>
        `;
    });
}

function loadFromText() {
    const text = document.getElementById("jsonInput").value.trim();
    if (!text) return alert("Paste JSON first.");
    try {
        const parsed = JSON.parse(text);
        renderSystem(parsed);
    } catch {
        alert("Invalid JSON.");
    }
}

function clearViewer() {
    document.getElementById("jsonInput").value = "";
    document.getElementById("systemInfo").innerHTML = "";
    document.getElementById("tabsSection").style.display = "none";
}

document.getElementById("fileInput").addEventListener("change", function(e) {
    const file = e.target.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = function(event) {
        try {
            const parsed = JSON.parse(event.target.result);
            renderSystem(parsed);
        } catch {
            alert("Invalid JSON file.");
        }
    };
    reader.readAsText(file);
});

</script>

</body>
</html>